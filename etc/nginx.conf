server {
	listen [::]:80;
	
	server_name www.mylesb.ca;
	
	rewrite ^(.*)
		http://mylesb.ca$1?utm_source=no-www&utm_medium=no-www&utm_campaign=no-www
		permanent;
}

server {
	listen [::]:80;
	
	server_name ~^(?<subdomain>.+).mylesb.ca$;
	
	rewrite ^(.*)
		http://mylesb.ca$1?utm_source=$subdomain&utm_medium=$subdomain&utm_campaign=$subdomain
		permanent;
}

server {
	listen [::]:80;
	
	server_name mylesb.ca 27rbn47kt7aurbyo.onion;
	
	root /srv/www/ca_mylesb_www/html;
	
	location = /e {
		rewrite ^(.*)$ /?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /t {
		rewrite ^(.*)$ /?utm_source=twitter&utm_medium=twitter&utm_campaign=twitter redirect;
	}
	
	location = /g {
		rewrite ^(.*)$ /?utm_source=google-plus&utm_medium=google-plus&utm_campaign=google-plus redirect;
	}
	
	location = /f {
		rewrite ^(.*)$ /?utm_source=facebook&utm_medium=facebook&utm_campaign=facebook redirect;
	}
	
	location = /i {
		rewrite ^(.*)$ /?utm_source=ios&utm_medium=ios&utm_campaign=ios redirect;
	}
	
	location = /e/bcorp {
		rewrite ^(.*)$ /b-corp.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/miys {
		rewrite ^(.*)$ /miys.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-ca {
		rewrite ^(.*)$ /btci.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-uk {
		rewrite ^(.*)$ /btrcl.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-ir {
		rewrite ^(.*)$ /btcl.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-us {
		rewrite ^(.*)$ /bgi.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/grd {
                rewrite ^(.*)$ /grd.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
        }
	
	location = /e/pvt {
		rewrite ^(.*)$ /pvt.html?passcode=hoping-for-the-best-imagining-the-worst&utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /gpg {
		rewrite ^(.*)$ /static/uploads/5A2FE7BF.asc redirect;
	}
	
	location = /static/uploads/5A2FE7BF.key {
		rewrite ^(.*)$ /static/uploads/5A2FE7BF.asc;
	}

	error_log /srv/www/ca_mylesb_www/logs/error.log;
	access_log /srv/www/ca_mylesb_www/logs/access.log;
}

server {
	listen [::]:443 ssl;
	
	server_name www.mylesb.ca;
	
	ssl_certificate /etc/ssl/localcerts/apache.crt;
	ssl_certificate_key /etc/ssl/localcerts/apache.key;
	
	rewrite ^(.*) https://mylesb.ca$1 permanent;
}

server {
	listen [::]:443 ssl;
	
	server_name mylesb.ca 27rbn47kt7aurbyo.onion;	

	ssl_certificate /etc/ssl/localcerts/apache.crt;
	ssl_certificate_key /etc/ssl/localcerts/apache.key;
	
	root /srv/www/ca_mylesb_www/html;
	
	location = /e {
		rewrite ^(.*)$ /?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /t {
		rewrite ^(.*)$ /?utm_source=twitter&utm_medium=twitter&utm_campaign=twitter redirect;
	}
	
	location = /g {
		rewrite ^(.*)$ /?utm_source=google-plus&utm_medium=google-plus&utm_campaign=google-plus redirect;
	}
	
	location = /f {
		rewrite ^(.*)$ /?utm_source=facebook&utm_medium=facebook&utm_campaign=facebook redirect;
	}
	
	location = /i {
		rewrite ^(.*)$ /?utm_source=ios&utm_medium=ios&utm_campaign=ios redirect;
	}
	
	location = /e/bcorp {
		rewrite ^(.*)$ /b-corp.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/miys {
		rewrite ^(.*)$ /miys.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-ca {
		rewrite ^(.*)$ /btci.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-uk {
		rewrite ^(.*)$ /btrcl.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-ir {
		rewrite ^(.*)$ /btcl.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/b-us {
		rewrite ^(.*)$ /bgi.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/grd {
		rewrite ^(.*)$ /grd.html?utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /e/pvt {
		rewrite ^(.*)$ /pvt.html?passcode=hoping-for-the-best-imagining-the-worst&utm_source=email&utm_medium=email&utm_campaign=email redirect;
	}
	
	location = /gpg {
		rewrite ^(.*)$ /static/uploads/5A2FE7BF.asc redirect;
	}
    
	location = /static/uploads/5A2FE7BF.key {
		rewrite ^(.*)$ /static/uploads/5A2FE7BF.asc;
	}
	
	error_log /srv/www/ca_mylesb_www/logs/ssl-error.log;
	access_log /srv/www/ca_mylesb_www/logs/ssl-access.log;
}
